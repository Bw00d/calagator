<%= google_map @event %>
<div class="vevent">
	<h1 class="summary"><%= @event.title %></h1>

	<%
	unless @event.end_time.nil?
		if @event.start_time.strftime('%Y:%j') != @event.end_time.strftime('%Y:%j')
			span_days = true
		end
		end_format = @event.end_time.min ? '%I:%M%p' : '%I%p'
	end
	start_format = @event.start_time.min ? '%I:%M%p' : '%I%p'
	%>

	<div class='date'>
		<abbr class="dtstart" title="<%=@event.start_time.strftime('%Y-%m-%dT%H:%M:%S')%>">
			<span class='weekday'><%= @event.start_time.strftime('%A') %></span>,
			<span class="month"><%= @event.start_time.strftime("%B") %></span>
			<span class="day"><%= @event.start_time.day %></span>;
			<span class="time"><%= @event.start_time.strftime(start_format).downcase %></span>
		</abbr>
		<% unless @event.end_time.nil? %>
		&ndash;
		<abbr class="dtend" title="<%=@event.end_time.strftime('%Y-%m-%dT%H:%M:%S')%>">
			<% if span_days %>
				<span class='weekday'><%= @event.end_time.strftime('%A') %></span>,
				<span class="month"><%= @event.end_time.strftime("%B") %></span>
				<span class="day"><%= @event.end_time.day %></span>;
			<% end %>
			<span class="time"><%= @event.end_time.strftime(end_format).downcase %></span>
		</abbr>
		<% end %>
	</div>

  <% unless @event.venue.blank? %>
    <div class="location vcard">
		<a href='<%= url_for venue_path(@event.venue) %>' class='url'>
		    <span class='fn org'><%= h @event.venue.title %></span>
		</a>
		<div class="adr">
			<% if !@event.venue.street_address.blank? %>
				<div class="street-address"><%= @event.venue.street_address %></div>
			<% end %>
			<% if !@event.venue.locality.blank? %>
				<span class="locality"><%= @event.venue.locality %></span>
			<% end %>
			<% if !@event.venue.region.blank? %>
				, <span class="region"><%= @event.venue.region %></span>
			<% end %>
			<% if !@event.venue.postal_code.blank? %>
				<span class="postal-code"><%= @event.venue.postal_code %></span>
			<% end %>
			<% if !@event.venue.country.blank? %>
				<div class='country-name'><%= @event.venue.country %><div>
			<% end %>
      <% if @event.venue && @event.venue.has_full_address? %>
        (<a href='<%=google_maps_url(@event.venue.full_address)%>'>map</a>)
      <% end %>
		</div>
    </div>
  <% end %>

  <% unless @event.description.blank? %>
	<div class="description">
    <%= @event.description %>
	</div>
  <% end %>

  <% unless @event.url.blank? %>
	<h3>Links</h3>
	<ul>
		<li><%= link_to "Website", @event.url, :class => "url" %></li>
	</ul>
  <% end %>

	<div class='single_view_right'>
		<a href='<%= event_url(@event) %>.ics'>Download to iCal</a>
		<div id='edit_link'>
			<h4>Something not right?</h4>
      <p>You can <%= link_to "edit this event", edit_event_url(@event) %>
      or <%= link_to "delete it", event_url(@event), :method => :delete, :confirm => "Are you sure?" %>.</p>
		</div>
		<div id='metadata'>
			This event was
			<% if @event.source.nil? %>
			added directly to Calagator
			<% else %>
			imported from <%= link_to @event.source.name, source_url(@event.source.id) %>
			<% end %>
			on <strong><%= @event.created_at.strftime('%a. %d, %Y') %> at <%= normalize_time(@event.created_at) %></strong>
			<% unless @event.created_at == @event.updated_at %>
			and last updated on <strong><%= @event.updated_at.strftime('%a. %d, %Y') %> at <%= normalize_time(@event.updated_at) %></strong>
			<% end %>.
		</div>
	</div>
</div>

